!function(){"use strict";function e(e,n){var t,a=[];for(c=arguments.length;c-- >2;)p.push(arguments[c]);for(;p.length;)if(Array.isArray(t=p.pop()))for(c=t.length;c--;)p.push(t[c]);else null!=t&&!0!==t&&!1!==t&&a.push("number"==typeof t?t+="":t);return"string"==typeof e?{type:e,props:n||{},children:a}:e(n||{},a)}function n(e,n){var t={};for(var a in e)t[a]=e[a];for(var a in n)t[a]=n[a];return t}function t(e,n){if("string"==typeof e)l=document.createTextNode(e);else{var l=(n=n||"svg"===e.type)?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type);e.props&&e.props.oncreate&&d.push(function(){e.props.oncreate(l)});for(r=0;r<e.children.length;r++)l.appendChild(t(e.children[r],n));for(var r in e.props)a(l,r,e.props[r])}return l}function a(e,t,a,l){if("key"===t);else if("style"===t)for(var t in n(l,a=a||{}))e.style[t]=a[t]||"";else{try{e[t]=a}catch(e){}"function"!=typeof a&&(a?e.setAttribute(t,a):e.removeAttribute(t))}}function l(e,n,t){function a(){e.removeChild(n)}t&&t.onremove&&"function"==typeof(t=t.onremove(n))?t(a):a()}function r(e){if(e&&e.props)return e.props.key}function o(e,i,s,c,p,u){if(null==s)i=e.insertBefore(t(c,p),i);else if(null!=c.type&&c.type===s.type){!function(e,t,l){for(var r in n(t,l)){var o=l[r],i="value"===r||"checked"===r?e[r]:t[r];o!==i&&a(e,r,o,i)}l&&l.onupdate&&d.push(function(){l.onupdate(e,t)})}(i,s.props,c.props),p=p||"svg"===c.type;for(var g=c.children.length,y=s.children.length,f={},v=[],b={},h=0;h<y;h++){k=v[h]=i.childNodes[h];null!=(A=r(w=s.children[h]))&&(f[A]=[k,w])}for(var h=0,m=0;m<g;){var k=v[h],w=s.children[h],x=c.children[m];if(b[A=r(w)])h++;else{var S=r(x),T=f[S]||[];null==S?(null==A&&(o(i,k,w,x,p),m++),h++):(A===S?(o(i,T[0],T[1],x,p),h++):T[0]?(i.insertBefore(T[0],k),o(i,T[0],T[1],x,p)):o(i,k,null,x,p),m++,b[S]=x)}}for(;h<y;){var A=r(w=s.children[h]);null==A&&l(i,v[h],w.props),h++}for(var h in f){var N=(T=f[h])[1];b[N.props.key]||l(i,T[0],N.props)}}else i&&c!==i.nodeValue&&("string"==typeof c&&"string"==typeof s?i.nodeValue=c:(i=e.insertBefore(t(c,p),u=i),l(e,u,s.props)));return i}function i(e,n){var t,a="",l=typeof e;if(e&&"string"===l||"number"===l)return e;if(n=n||" ",Array.isArray(e)&&e.length)for(var r=0,o=e.length;r<o;r++)(t=i(e[r],n))&&(a+=(a&&n)+t);else for(var r in e)e.hasOwnProperty(r)&&(t=e[r])&&(a+=(a&&n)+r+("object"==typeof t?i(t,n+r):""));return a}function s(e,n){const t=[];for(var a=0;a<e;a++)t.push(n(a));return t}!function(e){if(e||window){var n=document.createElement("style");n.setAttribute("media","screen"),n.innerHTML=e,document.head.appendChild(n)}}("body {\n  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n  font-size: 13px;\n}\ndiv.app-layout {\n  display: flex;\n}\ndiv.app-layout div.app-layout-left {\n  flex: 0 0 800px;\n}\ndiv.app-layout div.app-layout-right {\n  flex: 1 0 1px;\n}\nbutton {\n  font-weight: bold;\n  background-color: #444;\n  color: #fff;\n  border: 2px black solid;\n  height: 25px;\n  line-height: 15px;\n}\nbutton.active {\n  background-color: #e9931d;\n  color: #000;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n  -webkit-appearance: none;\n  width: 300px;\n  height: 6px;\n  border-radius: 3px;\n  background-color: #e9931d;\n}\ninput[type=range]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  border: 1px #000 solid;\n  height: 15px;\n  width: 5px;\n  background: #444;\n}\ndiv.main-panel {\n  background: #ddd;\n}\ntable.sequencer {\n  border-collapse: collapse;\n}\ntable.sequencer td {\n  border: 1px #ccc solid;\n  width: 50px;\n}\ntable.sequencer td.selected {\n  background: #e9931d;\n}\ntable.sequencer td.time {\n  background: #ccc;\n  text-align: right;\n}\ntable.sequencer td.playing {\n  background: #ddd;\n}\ndiv.keyboard {\n  height: 200px;\n  width: 100%;\n  display: flex;\n  position: relative;\n}\ndiv.keyboard div.clav {\n  position: relative;\n  flex: 1 0 auto;\n  width: 4.67%;\n  margin: 0;\n  padding: 0;\n  background-color: #fff;\n  height: 99%;\n  border-bottom-left-radius: 10px;\n  border-bottom-right-radius: 10px;\n  border: 1px #000 solid;\n  border-right: none;\n}\ndiv.keyboard div.clav.pressed {\n  background-color: #e9931d;\n}\ndiv.keyboard div.clav.black {\n  height: 60%;\n  width: 3%;\n  margin-left: -5%;\n  left: 2.5%;\n  z-index: 100;\n  background-color: #444;\n  color: #fff;\n}\ndiv.keyboard div.clav.black.pressed {\n  background-color: #e9931d;\n}\ndiv.keyboard div.clav span.char {\n  display: block;\n  position: absolute;\n  bottom: 10px;\n  width: 100%;\n  text-align: center;\n}\ndiv.synth-panel {\n  display: flex;\n  padding: 15px;\n  position: relative;\n}\ndiv.synth-panel span.label {\n  display: inline-block;\n  width: 80px;\n}\ndiv.synth-panel .col-1 {\n  width: 1px;\n  flex: 1 0 auto;\n}\ndiv.synth-panel .col-2 {\n  width: 1px;\n  flex: 1 0 auto;\n}\ndiv.synth-panel input[type=range] {\n  -webkit-appearance: none;\n  width: 200px;\n}\ndiv.synth-panel input[type=range]::-webkit-slide-runnable-track {\n  -webkit-appearance: none;\n  height: 6px;\n  border-radius: 3px;\n  background-color: #e9931d;\n}\ndiv.synth-panel input[type=range]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  border: 1px #000 solid;\n  height: 15px;\n  width: 8px;\n  border-radius: 2px;\n  margin-top: -4px;\n  background: #444;\n}\ndiv.voice-selector {\n  display: block;\n  padding: 15px;\n  text-align: right;\n  border-bottom: 1px #555 solid;\n}\ndiv.voice-selector button {\n  margin-left: 10px;\n}\n");var c,p=[],d=[];const{table:u,tr:g,td:y,span:f,button:v,div:b,label:h,p:m,input:k}=function(n){return n.replace(/\s/g,"").split(",").reduce((n,t)=>(n[t]=function(n){return(t,a)=>"object"!=typeof t||Array.isArray(t)?e(n,{},t):e(n,t,a)}(t),n),{})}("\n    table,\n    tr,\n    td,\n    span,\n    button,\n    div,\n    label,\n    p,\n    input,\n"),w=32,x=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B","C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B","C"],S=["z","s","x","d","c","v","g","b","h","n","j","m","q","2","w","3","e","r","5","t","6","y","7","u","i"],T=["s","d","g","h","j","2","3","5","6","7"],A={octave:4,oscillatorType:"triangle",ampLevel:.3,sustainLevel:.6,attackTime:.02,decayTime:.04,releaseTime:.4,filterCutoff:7600,filterQ:10},N=["sawtooth","square","triangle","sine"],R=440,E=69,C=e=>T.indexOf(e)>-1;const D=({label:e},n)=>m([].concat(f({class:"label"},e),n)),O=({label:e,value:n,set:t,min:a,max:l,step:r})=>D({label:e},[k({type:"range",min:a||0,max:l,step:r||"any",value:n,oninput:e=>t(e.currentTarget.value)})]);const P=function(e,n){const t=[];for(var a=0;a<e;a++)t.push(n(a));return t}(8,e=>e);var V;const L=((e,n)=>{var t=!1;const a=e=>{var l={};return{set:e=>{l=Object.assign({},l,e),t||(t=!t,setTimeout(e=>{t=!t,n()}))},with:(e=>n=>"function"==typeof n?e(n):Object.keys(n).reduce((t,a)=>(t[a]=e(n[a]),t),{}))(e=>(...n)=>e(l,...n)),sync:(e,...n)=>e(a(),...n)}};return e(a())})(e=>{const{voices:n,notes:t}=JSON.parse(localStorage.getItem("SYNTHDATA")||{}),a=e.sync((e,n,{onselect:t})=>{e.set({selected:0});const a=new(window.AudioContext||window.webkitAudioContext),l=P.map(t=>e.sync((e,n,t)=>{e.set(t||A),e.set({playing:null});const a=n.createOscillator(),l=n.createBiquadFilter(),r=n.createGain(),o=n.createGain();a.connect(l),l.connect(r),r.connect(o),o.connect(n.destination),l.type="lowpass",r.gain.value=0,a.start(),e.with(e=>{a.type=e.oscillatorType,l.frequency.value=e.filterCutoff,l.Q.value=e.filterQ,o.gain.value=e.ampLevel})();const s=e.with((n=>Object.keys(n).reduce((t,a)=>{const[l,r,o]=n[a];return t[a]=(n=>l(Object.assign(r,{value:n[a],set:n=>{e.set({[a]:n}),o&&o(n)}}))),t},{}))({octave:[O,{label:"Octave",min:1,max:6,step:1}],attackTime:[O,{label:"Attack Time",max:.2}],decayTime:[O,{label:"Decay Time",max:.2}],sustainLevel:[O,{label:"Sustain Level",max:1}],releaseTime:[O,{label:"Release Time",max:.2}],oscillatorType:[({value:e,set:n,options:t,label:a})=>D({label:a},f(t.map(t=>v({class:i({active:e===t}),onclick:e=>n(t)},t)))),{label:"Oscillator",options:N},e=>a.type=e],filterCutoff:[O,{label:"Cutoff",min:60,max:7600},e=>l.frequency.value=e],filterQ:[O,{label:"Resonance",max:20},e=>l.Q.value=e],ampLevel:[O,{label:"Gain",max:1},e=>o.gain.value=e]})),c=e.with({attack:(t,l)=>{if(t.playing===l)return;e.set({playing:l});const o=function(e,n){return Math.exp((12*n+e-E)*Math.log(2)/12)*R}(l,t.octave);var i=n.currentTime;a.frequency.cancelScheduledValues(i),r.gain.cancelScheduledValues(i),i+=.01,a.frequency.linearRampToValueAtTime(o,i),r.gain.linearRampToValueAtTime(0,i),i+=+t.attackTime,r.gain.linearRampToValueAtTime(1,i),i+=+t.decayTime,r.gain.linearRampToValueAtTime(+t.sustainLevel,i)},release:(t,a)=>{if(t.playing===a){e.set({playing:null});var l=n.currentTime+.01;r.gain.cancelScheduledValues(l),l+=+t.releaseTime,r.gain.linearRampToValueAtTime(0,l)}},stop:e=>c.release(e.playing),getPersistentData:e=>e,panel:(e,n,t)=>b({class:"synth-panel"},[b({class:"col-1"},[s.oscillatorType(),s.octave(),s.filterCutoff(),s.filterQ()]),b({class:"col-2"},[s.attackTime(),s.decayTime(),s.sustainLevel(),s.releaseTime(),s.ampLevel()])])});return c},a,n[t])),r=e.with(e=>l[e.selected]);return{getSelected:e.with(e=>e.selected),setSelected:n=>e.set({selected:n}),getPersistentData:e=>l.map(e=>e.getPersistentData()),attackSelected:e=>r().attack(e),releaseSelected:e=>r().release(e),attack:(e,n)=>l[n].attack(e),release:(e,n)=>l[n].release(e),stopAll:e=>l.forEach(e=>e.stop()),selector:e.with(n=>b({class:"voice-selector"},l.map((a,l)=>v({onmousedown:n=>(n=>{e.set({selected:n}),t()})(l),class:i({active:n.selected===l})},"Voice "+(l+1))))),panel:e=>r().panel()}},n,{onselect:e=>r.resetSelection()}),l=e.sync((e,{onattack:n,onrelease:t})=>{e.set({pressed:null});const a=e.with({attack:(t,a)=>{const l=S.indexOf(a);return-1!==l&&(a===t.pressed||(a!==t.pressed&&n(l),e.set({pressed:a}),!0))},release:(n,a)=>{const l=S.indexOf(a);return-1!==l&&(a!==n.pressed||(a===n.pressed&&t(l),e.set({pressed:null}),!0))}});return addEventListener("keydown",e=>a.attack(e.key)&&e.preventDefault(!0)),addEventListener("keyup",e=>a.release(e.key)&&e.preventDefault(!0)),e.with(e=>b({class:"keyboard"},S.map(n=>b({class:i(["clav",{white:!C(n),black:C(n),pressed:n===e.pressed}]),onmousedown:e=>a.attack(n),onmouseup:e=>a.release(n)},f({class:"char"},n.toUpperCase())))))},{onattack:e=>{a.attackSelected(e),r.attack(e,a.getSelected())},onrelease:e=>{a.releaseSelected(e),r.release(e,a.getSelected())}}),r=e.sync((e,n,{onselectVoice:t,getSelectedVoice:a,onattack:l,onrelease:r,onstop:o})=>{e.set({grid:n||s(w,e=>s(8,e=>null)),selecting:!1,selectionStart:null,selectionEnd:null,playing:!1,playInterval:null,playRow:0,recording:!1,recordingNote:null}),addEventListener("mouseup",e=>{c.stopSelecting()}),addEventListener("keydown",e=>{" "===e.key&&(e.preventDefault(!0),c.clearSelection())});const c=e.with({startSelecting(n,a,l){n.selecting||(t(l),e.set({selecting:!0,selectionStart:a,selectionEnd:a}))},selectRow(n,t){n.selecting&&e.set({selectionEnd:t})},stopSelecting(n){n.selecting&&e.set({selecting:!1})},resetSelection(){e.set({selecting:!1,selectionStart:null,selectionEnd:null})},isSelected(e,n,t){if(null===e.selectionStart)return!1;if(t!==a())return!1;const l=e.selectionStart,r=e.selectionEnd,[o,i]=l<=r?[l,r]:[r,l];return n>=o&&n<=i},setNoteOnSelection(n,t){if(null===n.selectionStart)return;const a=n.grid.map((e,n)=>e.map((e,a)=>c.isSelected(n,a)?t:e));e.set({grid:a}),c.resetSelection()},clearSelection(){c.setNoteOnSelection(null)},startPlayback(n){n.playing||e.set({playing:!0,playInterval:setInterval(c.playNext,100)})},playNext(n){const t=n.playRow,o=(n.playRow+1)%w;e.set({playRow:o});const i=n.grid[o],s=n.grid[t];i.forEach((e,n)=>{const t=s[n];null===t?null!==e&&l(e,n):null===e?r(t,n):t!==e&&l(e,n)}),n.recordingNote&&(n.grid[t][a()]=n.recordingNote,e.set({grid:n.grid}))},setPlayTime(n,t){e.set({playTime:t})},stopPlayback(n){n.playing&&(clearInterval(n.playInterval),e.set({playing:!1,playInterval:null,recording:!1,recordingNote:null}),o())},startRecording(n){c.startPlayback(),e.set({recording:!0})},setRecordedNote(n,t){n.recording&&e.set({recordingNote:t})}});return e.with({resetSelection(){c.resetSelection()},attack(e,n){c.setNoteOnSelection(n),c.setRecordedNote(n)},release(){c.setRecordedNote(null)},getPersistentData:e=>e.grid,grid:e=>u({class:"sequencer"},e.grid.map((n,t)=>g([].concat(y({class:i(["time",{playing:e.playTime===t}]),onclick:e=>c.setPlayTime(t)},t),n.map((n,a)=>y({class:i({playing:e.playRow===t,selected:c.isSelected(t,a)}),onmousedown:e=>{e.preventDefault(!0),c.startSelecting(t,a)},onmousemove:e=>{e.preventDefault(!0),c.selectRow(t)}},function(e){return null===e?"":x[e]}(n))))))),controls:e=>f([v({onmousedown:c.startRecording,class:i({active:e.recording})},"Rec"),v({onmousedown:c.startPlayback,class:i({active:e.playing})},"Play"),v({onmousedown:c.stopPlayback},"Stop"),v({onmousedown:c.clearSelection},"X")])})},t,{onselectVoice:e=>a.setSelected(e),onattack:(e,n)=>a.attack(e,n),onrelease:(e,n)=>a.release(e,n),getSelectedVoice:a.getSelected,onstop:a.stopAll});return e=>(localStorage.setItem("SYNTHDATA",JSON.stringify({voices:a.getPersistentData(),notes:r.getPersistentData()})),b({class:"app-layout"},[b({class:"app-layout-left"},[b({class:"main-panel"},[r.controls(),a.selector(),a.panel()]),l()]),b({class:"app-layout-right"},[r.grid()])]))},e=>(function(e,n,t,a){for(var l=o(t||(t=document.body),t.children[0],e,n);a=d.pop();)a();return l})(V,V=L()))}();
