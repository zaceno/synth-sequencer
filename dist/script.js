!function e(t,n,i){function a(o,r){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return a(n||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,n){(function(i){!function(e){"object"==typeof n&&void 0!==t?t.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).partial=e()}(function(){return function t(n,i,a){function s(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof e&&e;if(!l&&c)return c(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[r]={exports:{}};n[r][0].call(p.exports,function(e){return s(n[r][1][e]||e)},p,p.exports,t,n,i,a)}return i[r].exports}for(var o="function"==typeof e&&e,r=0;r<a.length;r++)s(a[r]);return s}({1:[function(e,t,n){const i=(e,t,n)=>i=>n({[e]:Object.assign(t[e],i)}),a=(e,t)=>(n,a,s)=>o=>{const r=t(n[e],a[e],s),l=i(e,n,o);return"function"==typeof r?r(l):l(r)},s=(e,t)=>{const n={};for(let i in t)n[i]=a(e,t[i]);return n},o=(e,t)=>(n,i,a)=>t(n[e],i[e],a),r=(e,t)=>{const n={};for(let i in t)"function"==typeof t[i]?n[i]=o(e,t[i]):n[i]=t[i].map(t=>o(e,t));return n},l=e=>{const t={},n=(e,n,i,a,s)=>(...o)=>t[a][s](e[a],n[a],i[a],...o),i=(e,i)=>{const a={};for(let s in t){a[s]={};for(let o in t[s])a[s][o]=n(e,i,a,s,o)}return a};return{events:{render:(e,t,n)=>(e,t)=>n(e,t,i(e,t)),registerWidget:(e,n,[i,a,s])=>{t[i]=t[i]||{},t[i][a]=s}}}};l.mixin=((e,t)=>n=>{const i=t(n);for(let t in i.views||{})n("registerWidget",[e,t,i.views[t]]);return{state:{[e]:i.state||{}},actions:{[e]:s(e,i.actions||{})},events:r(e,i.events||{})}}),t.exports=l},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){!function(e,i){"object"==typeof n&&void 0!==t?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i(e.hyperapp={})}(this,function(e){"use strict";var t,n=[],i=[];e.h=function(e,i){var a,s=[];for(t=arguments.length;t-- >2;)n.push(arguments[t]);for(;n.length;)if(Array.isArray(a=n.pop()))for(t=a.length;t--;)n.push(a[t]);else null!=a&&!0!==a&&!1!==a&&("number"==typeof a&&(a+=""),s.push(a));return"string"==typeof e?{tag:e,data:i||{},children:s}:e(i,s)},e.app=function(e){function t(e,n,i){Object.keys(n||[]).map(function(a){var r=n[a],l=i?i+"."+a:a;"function"==typeof r?e[a]=function(e){o("action",{name:l,data:e});var t=o("resolve",r(m,g,e));return"function"==typeof t?t(s):s(t)}:t(e[a]||(e[a]={}),r,l)})}function n(e){for(b=d(N,b,v,v=o("render",h)(m,g),y=!y);e=i.pop();)e()}function a(){h&&!y&&requestAnimationFrame(n,y=!y)}function s(e){return e&&(e=o("update",r(m,e)))&&a(m=e),m}function o(e,t){return(T[e]||[]).map(function(e){var n=e(m,g,t);null!=n&&(t=n)}),t}function r(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n}function l(e){if(e&&(e=e.data))return e.key}function c(e,t){if("string"==typeof e)n=document.createTextNode(e);else{var n=(t=t||"svg"===e.tag)?document.createElementNS("http://www.w3.org/2000/svg",e.tag):document.createElement(e.tag);e.data&&e.data.oncreate&&i.push(function(){e.data.oncreate(n)});for(var a in e.data)u(n,a,e.data[a]);for(a=0;a<e.children.length;)n.appendChild(c(e.children[a++],t))}return n}function u(e,t,n,i){if("key"===t);else if("style"===t)for(var a in r(i,n=n||{}))e.style[a]=n[a]||"";else{try{e[t]=n}catch(e){}"function"!=typeof n&&(n?e.setAttribute(t,n):e.removeAttribute(t))}}function p(e,t,n){for(var a in r(t,n)){var s=n[a],o="value"===a||"checked"===a?e[a]:t[a];s!==o&&u(e,a,s,o)}n&&n.onupdate&&i.push(function(){n.onupdate(e,t)})}function f(e,t,n){n&&n.onremove?n.onremove(t):e.removeChild(t)}function d(e,t,n,i,a,s){if(null==n)t=e.insertBefore(c(i,a),t);else if(null!=i.tag&&i.tag===n.tag){p(t,n.data,i.data),a=a||"svg"===i.tag;for(var o=i.children.length,r=n.children.length,u={},m=[],v={},y=0;y<r;y++)g=m[y]=t.childNodes[y],null!=(x=l(T=n.children[y]))&&(u[x]=[g,T]);for(var y=0,h=0;h<o;){var g=m[y],T=n.children[y],_=i.children[h];if(v[x=l(T)])y++;else{var N=l(_),b=u[N]||[];null==N?(null==x&&(d(t,g,T,_,a),h++),y++):(x===N?(d(t,b[0],b[1],_,a),y++):b[0]?(t.insertBefore(b[0],g),d(t,b[0],b[1],_,a)):d(t,g,null,_,a),h++,v[N]=_)}}for(;y<r;){var x=l(T=n.children[y]);null==x&&f(t,m[y],T.data),y++}for(var y in u){var k=(b=u[y])[1];v[k.data.key]||f(t,b[0],k.data)}}else t&&i!==t.nodeValue&&(t=e.insertBefore(c(i,a),s=t),f(e,s,n.data));return t}for(var m,v,y,h=e.view,g={},T={},_=e.mixins||[],N=e.root||document.body,b=N.children[0],x=0;x<=_.length;x++){var k=_[x]?_[x](o):e;Object.keys(k.events||[]).map(function(e){T[e]=(T[e]||[]).concat(k.events[e])}),t(g,k.actions),m=r(m,k.state)}return a((v=o("load",b))===b&&(v=b=null)),o}})},{}],3:[function(e,t,n){const{app:i,h:a}=e("hyperapp"),s=e("hyperapp-partial"),o=i({state:{},mixins:[s,s.mixin("keyboard",e("./keyboard")),s.mixin("synthpanel",e("./synthpanel")),s.mixin("voices",e("./voices")),s.mixin("sequencer",e("./sequencer"))],events:{load(e,t){setTimeout(e=>{const t=localStorage.getItem("SYNTHDATA");if(!t)return;const{voices:n,notes:i}=JSON.parse(t);n&&o("persist:setVoices",n),i&&o("persist:setNotes",i)},0)},update(e,t){setTimeout(e=>{localStorage.setItem("SYNTHDATA",JSON.stringify({voices:o("persist:getVoices"),notes:o("persist:getNotes")}))})}},view:(e,t,n)=>a("app-layout",{},["\n            ",a("app-layout-left",{},["\n                ",a("main-panel",{},["\n                    ",n.sequencer.controller(),"\n                    ",n.voices.voices(),"\n                    ",n.synthpanel.synthpanel(),"\n                "]),"\n                ",n.keyboard.keyboard(),"\n            "]),"\n            ",a("app-layout-right",{},["\n                ",n.sequencer.sequencer(),"\n            "]),"\n        "])})},{"./keyboard":4,"./sequencer":5,"./synthpanel":7,"./voices":8,hyperapp:2,"hyperapp-partial":1}],4:[function(e,t,n){const{h:i}=e("hyperapp"),a=["Z","S","X","D","C","V","G","B","H","N","J","M","Q","2","W","3","E","R","5","T","6","Y","7","U","I"],s=["S","D","G","H","J","2","3","5","6","7"],o=function(e){return s.indexOf(e)>-1},r=function(e){const t=a.indexOf(e);return t>-1?t:null};t.exports=(e=>({state:{pressed:null},actions:{down(t,n,i){const a=r(i);if(null!==a&&i!==t.pressed)return t.pressed=i,e("keyboard:attackNote",a),t},up(t,n,i){const a=r(i);if(null!==a&&i===t.pressed)return t.pressed=null,e("keyboard:releaseNote",a),t}},events:{load(e,t){document.addEventListener("keydown",e=>{t.down(String.fromCharCode(e.keyCode))}),document.addEventListener("keyup",e=>{t.up(String.fromCharCode(e.keyCode))})}},views:{keyboard:({pressed:e},{down:t,up:n})=>i("keyboard",{},["\n                ",a.map(a=>i("clav",{onmousedown:e=>t(a),onmouseup:e=>n(a),className:(o(a)?"black":"white")+(e===a?" pressed":"")},["\n                    ",i("char",{},[a]),"\n                "])),"\n            "])}}))},{hyperapp:2}],5:[function(e,t,n){function i(e){return null===e?"":r[e]}function a({voice:e,start:t,end:n},i,a){return e===i&&(a>=t&&a<=n||a<=t&&a>=n)}const{h:s}=e("hyperapp"),o=100,r=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B","C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"];t.exports=(e=>({state:{times:[...Array(32).keys()].map(e=>[...Array(8).keys()].map(e=>null)),selection:{selecting:!1,start:-1,end:-1,voice:-1},playing:{recordNote:null,record:!1,interval:null,time:-1}},actions:{startSelecting:(t,n,[i,a])=>(t.selection.selecting=!0,t.selection.start=i,t.selection.voice=a,e("sequencer:selectVoice",a),t.selection.end=i,t),setSelection(e,t,n){if(e.selection.selecting)return e.selection.end=n,e},stopSelecting:(e,t,n)=>(e.selection.selecting=!1,e),setNote(e,t,n){if(-1===e.selection.start)return;const{start:i,end:a,voice:s}=e.selection,[o,r]=i<a?[i,a]:[a,i];for(var l=o;l<=r;l++)e.times[l][s]=n;return e.selection.start=-1,e.selection.end=-1,e},_setRecordedNote(t,n){if(t.playing.record&&null!==t.playing.recordNote)return t.times[t.playing.time][e("voices:selectedIndex?")]=t.playing.recordNote,t},_recordAttackNote(e,t,n){if(e.playing.record)return e.playing.recordNote=n,e},recordAttackNote(e,t,n){t._recordAttackNote(n),t._setRecordedNote()},recordReleaseNote(e,t,n){e.playing.recordNote=null},_nextNote(t,n){const i=t.playing.time,a=-1===i?[...Array(8).keys()].map(e=>null):t.times[i],s=(i+1)%t.times.length,o=t.times[s];for(var r=0;r<8;r++)a[r]!==o[r]&&(null===o[r]?e("sequencer:releaseNote",{voice:r,note:a[r]}):e("sequencer:attackNote",{voice:r,note:o[r]}));return t.playing.time=s,t},nextNote(e,t){t._nextNote(),t._setRecordedNote()},startPlaying(e,t,n){if(!e.playing.interval)return e.playing.interval=setInterval(t.nextNote,o),e.playing.record=n||!1,e},startRecording(e,t){t.startPlaying(!0)},stopPlaying:(t,n)=>(t.playing.interval&&clearInterval(t.playing.interval),t.playing.interval=null,t.playing.record=!1,e("sequencer:stopped"),t),setSavedTimes(e,t,n){if(n)return e.times=n,e},setTime:(e,t,n)=>(e.playing.time=n,e)},events:{load:(e,t)=>{window.addEventListener("mouseup",t.stopSelecting),window.addEventListener("keydown",e=>{32===e.keyCode&&t.setNote(null)})},"keyboard:attackNote":[(e,t,n)=>(t.setNote(n),n),(e,t,n)=>(t.recordAttackNote(n),n)],"keyboard:releaseNote":[(e,t,n)=>t.recordReleaseNote(n)],"persist:getNotes":(e,t)=>e.times,"persist:setNotes":(e,t,n)=>t.setSavedTimes(n)},views:{sequencer:(e,t)=>s("table",{className:"sequencer"},["\n                ",e.times.map((n,o)=>s("tr",{},["\n                    ",s("td",{onclick:e=>t.setTime(o),className:"time"},[o]),"\n                    ",n.map((n,r)=>s("td",{onmousedown:e=>{e.preventDefault(!0),t.startSelecting([o,r])},onmouseover:e=>{e.preventDefault(!0),t.setSelection(o)},className:(a(e.selection,r,o)?"selected":"")+(e.playing.time===o?" playing":"")},["\n                        ",i(n),"\n                    "])),"\n                "])),"\n            "]),controller:(e,t)=>s("span",{},["\n                ",s("button",{onmousedown:t.startRecording,className:e.playing.record?"active":""},["Rec"]),"\n                ",s("button",{onmousedown:t.startPlaying,className:e.playing.interval?"active":""},["Play"]),"\n                ",s("button",{onmousedown:t.stopPlaying},["Stop"]),"\n                ",s("button",{onmousedown:e=>t.setNote(null)},["X"]),"\n            "])}}))},{hyperapp:2}],6:[function(e,t,n){function i(e,t){return Math.exp((12*t+e-o)*Math.log(2)/12)*s}function a(e){return e=e||{},Object.assign({},c,e)}const s=440,o=69,r=["sawtooth","square","triangle","sine"],l=["bandpass","lowpass","highpass"],c={octave:4,oscillatorType:"triangle",ampLevel:.3,sustainLevel:.6,attackTime:.02,decayTime:.04,releaseTime:.4,filterType:"lowpass",filterCutoff:7600,filterQ:10};class u{constructor(e,t){t=a(t),this._ctx=e,this._osc=this._ctx.createOscillator(),this._osc.type=t.oscillatorType,this._flt=this._ctx.createBiquadFilter(),this._flt.type=t.filterType,this._flt.frequency.value=t.filterCutoff,this._flt.Q.value=t.filterQ,this._env=this._ctx.createGain(),this._env.gain.value=0,this._amp=this._ctx.createGain(),this._amp.gain.value=t.ampLevel,this._osc.connect(this._flt),this._flt.connect(this._env),this._env.connect(this._amp),this._amp.connect(this._ctx.destination),this._osc.start(),this.octave=t.octave,this.attackTime=t.attackTime,this.decayTime=t.decayTime,this.releaseTime=t.releaseTime,this.sustainLevel=t.sustainLevel,this._playing=!1}get oscillatorType(){return this._osc.type}set oscillatorType(e){this._osc.type=e}get ampLevel(){return this._amp.gain.value}set ampLevel(e){this._amp.gain.value=e}get filterType(){return this._flt.type}set filterType(e){this._flt.type=e}get filterCutoff(){return this._flt.frequency.value}set filterCutoff(e){this._flt.frequency.value=e}get filterQ(){return this._flt.Q.value}set filterQ(e){this._flt.Q.value=e}attack(e){if(this._playing===e)return;this._playing=e;const t=i(e,this.octave);var n=this._ctx.currentTime;this._osc.frequency.cancelScheduledValues(n),this._env.gain.cancelScheduledValues(n),n+=.01,this._osc.frequency.linearRampToValueAtTime(t,n),this._env.gain.linearRampToValueAtTime(0,n),n+=+this.attackTime,this._env.gain.linearRampToValueAtTime(1,n),n+=+this.decayTime,this._env.gain.linearRampToValueAtTime(+this.sustainLevel,n)}release(e){if(this._playing===e){this._playing=null;var t=this._ctx.currentTime+.01;this._env.gain.cancelScheduledValues(t),t+=+this.releaseTime,this._env.gain.linearRampToValueAtTime(0,t)}}stop(){null!==this._playing&&this.release(this._playing)}}t.exports={Synth:u,OSCILLATOR_TYPES:r,FILTER_TYPES:l}},{}],7:[function(e,t,n){const{h:i}=e("hyperapp"),{OSCILLATOR_TYPES:a,FILTER_TYPES:s}=e("./synth"),o=({value:e,set:t,min:n,max:a,step:s})=>i("input",{type:"range",min:n||0,max:a,step:s||"any",value:e,oninput:e=>t(e.currentTarget.value)}),r=({options:e,value:t,set:n})=>i("span",{},["\n        ",e.map(e=>i("button",{onclick:t=>n(e),className:t===e?"active":""},["\n                ",e,"\n            "])),"\n    "]);t.exports=(e=>({actions:{setProp:(t,n,[i,a])=>(e("voices:selected?")[i]=a,t)},views:{synthpanel:(t,n)=>{const l=e("voices:selected?"),c=e=>o(Object.assign({set:t=>n.setProp([e.name,t]),value:l[e.name]},e)),u=e=>r(Object.assign({set:t=>n.setProp([e.name,t]),value:l[e.name]},e));return i("synth-panel",{},["\n                ",i("div",{className:"col-1"},["\n                    ",i("p",{},["\n                        ",i("label",{},["Oscillator:"]),"\n                        ",u({name:"oscillatorType",options:a}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Octave:"]),"\n                        ",c({name:"octave",min:1,max:6,step:1}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Filter:"]),"\n                        ",u({name:"filterType",options:s}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Cutoff"]),"\n                        ",c({name:"filterCutoff",min:60,max:7600}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Resonance"]),"\n                        ",c({name:"filterQ",max:20}),"\n                    "]),"\n                "]),"\n                ",i("div",{className:"col-2"},["\n                    ",i("p",{},["\n                        ",i("label",{},["Attack Time:"]),"\n                        ",c({name:"attackTime",max:.2}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Decay Time:"]),"\n                        ",c({name:"decayTime",max:.2}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Release Time:"]),"\n                        ",c({name:"releaseTime",max:1}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Sustain Level:"]),"\n                        ",c({name:"sustainLevel",max:1}),"\n                    "]),"\n                    ",i("p",{},["\n                        ",i("label",{},["Amp Level:"]),"\n                        ",c({name:"ampLevel",max:1}),"\n                    "]),"\n                "]),"\n            "])}}}))},{"./synth":6,hyperapp:2}],8:[function(e,t,n){const{h:i}=e("hyperapp"),{Synth:a}=e("./synth"),s=new(window.AudioContext||window.webkitAudioContext),o=["oscillatorType","octave","filterType","filterCutoff","filterQ","attackTime","decayTime","releaseTime","sustainLevel","ampLevel"];t.exports=(e=>({state:{selected:0,list:[...Array(8).keys()].map(e=>new a(s))},actions:{select:(e,t,n)=>({selected:n})},events:{"persist:getVoices":({list:e})=>e.map(e=>{const t={};return o.forEach(n=>{t[n]=e[n]}),t}),"persist:setVoices":({list:e},t,n)=>{console.log(n),n.forEach((t,n)=>{o.forEach(i=>{e[n][i]=t[i]})})},"voices:selectedIndex?":({selected:e})=>e,"voices:selected?":({list:e,selected:t})=>e[t],"sequencer:stopped":({list:e})=>e.forEach(e=>e.stop()),"sequencer:selectVoice":(e,t,n)=>t.select(n),"sequencer:attackNote":({list:e},t,{voice:n,note:i})=>e[n].attack(i),"sequencer:releaseNote":({list:e},t,{voice:n,note:i})=>e[n].release(i),"keyboard:attackNote":({list:e,selected:t},n,i)=>e[t].attack(i),"keyboard:releaseNote":({list:e,selected:t},n,i)=>e[t].release(i)},views:{voices:({list:e,selected:t},{select:n})=>i("voice-selector",{},["\n                ",e.map((e,a)=>i("button",{onmousedown:e=>n(a),className:t===a?"active":""},["\n                    Voice ",a+1,"\n                "])),"\n            "])}}))},{"./synth":6,hyperapp:2}]},{},[3]);
