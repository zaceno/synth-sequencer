!function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n||e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){!function(e,o){"object"==typeof n&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):e.appEvents=o()}(this,function(){"use strict";var e=function(e,t){var n={};for(var o in e)n[o]=t(o,e[o]);return n},t=function(n,o){return n.modules=e(n.modules,function(e,n){return t(n,o)}),n.actions=e(n.actions,function(e,t){return function(e,n,i){return t(e,n,i,o)}}),n},n=function(t,n){var o=e(t,function(e,t){return t});for(var i in n)o[i]=[].concat(o[i]||[],n[i]);return o},o=function(t,n){return e(n,function(e,n){return n.map(function(e){return function(n,o,i){return e(n[t],o[t],i)}})})},i=function(e){var t={};for(var r in e.modules||{})t=n(t,o(r,i(e.modules[r])));return t=n(t,e.events)},r=function(e){return function(t,n,o){return function(){return(e[o[0]]||[]).reduce(function(e,i){return i(t,n,o[1])},null)}}};return function(e){return function(n,o){var s=function(){};(n=t(n,function(e,t){return s(e,t)})).actions.__emit=r(i(n));var a=e(n,o);return s=function(e,t){return a.__emit([e,t])},a}}})},{}],2:[function(e,t,n){!function(e,o){"object"==typeof n&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):e.moduleViews=o()}(this,function(){"use strict";return function(e){function t(e,t,n,o){return function(i,r){return o(e,t,n,i,r)}}function n(e,o,i){var r={};for(var s in i.modules||{})r[s]=n(e[s],o[s],i.modules[s]);for(var a in i.views||{})r[a]=t(e,o,r,i.views[a]);return r}return function(t,o){var i=t.view;return i&&(t.view=function(e,o){return i(e,o,n(e,o,t))}),e(t,o)}}})},{}],3:[function(e,t,n){!function(e,o){"object"==typeof n&&void 0!==t?o(n):"function"==typeof define&&define.amd?define(["exports"],o):o(e.hyperapp={})}(this,function(e){"use strict";function t(e,t){var i,r=[];for(n=arguments.length;n-- >2;)o.push(arguments[n]);for(;o.length;)if(Array.isArray(i=o.pop()))for(n=i.length;n--;)o.push(i[n]);else null!=i&&!0!==i&&!1!==i&&r.push("number"==typeof i?i+="":i);return"string"==typeof e?{type:e,props:t||{},children:r}:e(t||{},r)}var n,o=[];e.h=t,e.app=function(e,n){function o(){e.view&&!y&&requestAnimationFrame(i,y=!y)}function i(){r(T=h(n,T,N,N=e.view(g,_),y=!y))}function r(e){for(;e=w.pop();)e()}function s(e,n){return e&&t(e.tagName.toLowerCase(),{},n.call(e.childNodes,function(e){return 3===e.nodeType?e.nodeValue:s(e,n)}))}function a(e,t,n){e.init&&w.push(function(){e.init(t,n)}),l(t,e.state),c(t,n,e.actions);for(var o in e.modules)a(e.modules[o],t[o]={},n[o]={})}function c(e,t,n){function i(t){return"function"==typeof t?i(t(e)):t&&o(l(e,t)),e}Object.keys(n||{}).map(function(o){"function"==typeof n[o]?t[o]=function(r){return"function"==typeof(r=n[o](e,t,r))?r(i):i(r)}:c(e[o]||(e[o]={}),t[o]={},n[o])})}function l(e,t){for(var n in t)e[n]=t[n];return e}function u(e,t){return l(l({},e),t)}function p(e,t){if("string"==typeof e)n=document.createTextNode(e);else{var n=(t=t||"svg"===e.type)?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type);for(e.props&&e.props.oncreate&&w.push(function(){e.props.oncreate(n)}),o=0;o<e.children.length;o++)n.appendChild(p(e.children[o],t));for(var o in e.props)f(n,o,e.props[o])}return n}function f(e,t,n,o){if("key"===t);else if("style"===t)for(var t in u(o,n=n||{}))e.style[t]=n[t]||"";else{try{e[t]=n}catch(e){}"function"!=typeof n&&(n?e.setAttribute(t,n):e.removeAttribute(t))}}function d(e,t,n){for(var o in u(t,n)){var i=n[o],r="value"===o||"checked"===o?e[o]:t[o];i!==r&&i!==r&&f(e,o,i,r)}n&&n.onupdate&&w.push(function(){n.onupdate(e,t)})}function m(e,t,n){function o(){e.removeChild(t)}n&&n.onremove&&"function"==typeof(n=n.onremove(t))?n(o):o()}function v(e){if(e&&e.props)return e.props.key}function h(e,t,n,o,i,r){if(null==n)t=e.insertBefore(p(o,i),t);else if(null!=o.type&&o.type===n.type){d(t,n.props,o.props),i=i||"svg"===o.type;for(var s=o.children.length,a=n.children.length,c={},l=[],u={},f=0;f<a;f++)g=l[f]=t.childNodes[f],null!=(S=v(_=n.children[f]))&&(c[S]=[g,_]);for(var f=0,y=0;y<s;){var g=l[f],_=n.children[f],T=o.children[y];if(u[S=v(_)])f++;else{var N=v(T),w=c[N]||[];null==N?(null==S&&(h(t,g,_,T,i),y++),f++):(S===N?(h(t,w[0],w[1],T,i),f++):w[0]?(t.insertBefore(w[0],g),h(t,w[0],w[1],T,i)):h(t,g,null,T,i),y++,u[N]=T)}}for(;f<a;){var S=v(_=n.children[f]);null==S&&m(t,l[f],_.props),f++}for(var f in c){var k=(w=c[f])[1];u[k.props.key]||m(t,w[0],k.props)}}else t&&o!==t.nodeValue&&("string"==typeof o&&"string"==typeof n?t.nodeValue=o:(t=e.insertBefore(p(o,i),r=t),m(e,r,n.props)));return t}var y,g,_,T=(n=n||document.body).children[0],N=s(T,[].map),w=[];return o(r(a(e,g={},_={}))),_}})},{}],4:[function(e,t,n){const{app:o,h:i}=e("hyperapp");e("hyperapp-events")(e("hyperapp-module-views")(o))({modules:{input:e("./input"),synthcontrol:e("./synthcontrol"),sequencer:e("./sequencer")},actions:{persistState:(e,t,n,o)=>{localStorage.setItem("SYNTHDATA",JSON.stringify({voices:o("persist:getVoices"),notes:o("persist:getNotes")}))},loadState:(e,t,n,o)=>{const i=localStorage.getItem("SYNTHDATA");if(!i)return;const{voices:r,notes:s}=JSON.parse(i);r&&o("persist:setVoices",r),s&&o("persist:setNotes",s)}},view:(e,t,n)=>i("app-layout",{oncreate:t.loadState,onupdate:t.persistState},["\n            ",i("app-layout-left",{},["\n                ",i("main-panel",{},["\n                    ",n.sequencer.controls(),"\n                    ",n.synthcontrol.voices(),"\n                    ",n.synthcontrol.panel(),"\n                "]),"\n                ",n.input.keyboard(),"\n            "]),"\n            ",i("app-layout-right",{},["\n                ",n.sequencer.grid(),"\n            "]),"\n        "])})},{"./input":5,"./sequencer":6,"./synthcontrol":8,hyperapp:3,"hyperapp-events":1,"hyperapp-module-views":2}],5:[function(e,t,n){const{h:o}=e("hyperapp"),i=["Z","S","X","D","C","V","G","B","H","N","J","M","Q","2","W","3","E","R","5","T","6","Y","7","U","I"],r=["S","D","G","H","J","2","3","5","6","7"],s=function(e){return r.indexOf(e)>-1},a=function(e){const t=i.indexOf(e);return t>-1?t:null};t.exports={state:{pressed:null},actions:{down(e,t,n,o){const i=a(n);if(null!==i&&n!==e.pressed)return e.pressed=n,o("input:attackNote",i),e},up(e,t,n,o){const i=a(n);if(null!==i&&n===e.pressed)return e.pressed=null,o("input:releaseNote",i),e}},init(e,t){document.addEventListener("keydown",e=>{t.down(String.fromCharCode(e.keyCode))}),document.addEventListener("keyup",e=>{t.up(String.fromCharCode(e.keyCode))})},views:{keyboard:({pressed:e},{down:t,up:n})=>o("keyboard",{},["\n                ",i.map(i=>o("clav",{onmousedown:e=>t(i),onmouseup:e=>n(i),className:(s(i)?"black":"white")+(e===i?" pressed":"")},["\n                    ",o("char",{},[i]),"\n                "])),"\n            "])}}},{hyperapp:3}],6:[function(e,t,n){function o(e){return null===e?"":s[e]}function i({voice:e,selStart:t,selEnd:n},o,i){return e===o&&(i>=t&&i<=n||i<=t&&i>=n)}const{h:r}=e("hyperapp"),s=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B","C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"];t.exports={state:{mode:"editing",times:[...Array(32).keys()].map(e=>[...Array(8).keys()].map(e=>null)),selecting:!1,selStart:-1,selEnd:-1,voice:-1,recordNote:null,record:!1,interval:null,time:-1},actions:{resetSelection:(e,t)=>({selecting:!1,selStart:-1,selEnd:-1,voice:-1}),startSelection:(e,t,[n,o],i)=>t=>{"editing"===e.mode&&(t({selecting:!0,selStart:n,voice:o,selEnd:n}),i("sequencer:selectVoice",o))},stopSelection:(e,t,n)=>({selecting:!1}),setSelection:(e,t,n)=>t=>{e.selecting&&t({selEnd:n})},setNoteOnSelection:(e,t,n)=>o=>{if(-1===e.selStart)return;const{selStart:i,selEnd:r,voice:s}=e,[a,c]=i<r?[i,r]:[r,i];for(var l=a;l<=c;l++)e.times[l][s]=n;o(e),t.resetSelection()},_setRecordedNote(e,t,n,o){if(e.record&&null!==e.recordNote)return e.times[e.time][o("voices:selectedIndex?")]=e.recordNote,e},_recordAttackNote(e,t,n){if(e.record)return e.recordNote=n,e},recordAttackNote(e,t,n){t._recordAttackNote(n),t._setRecordedNote()},recordReleaseNote(e,t,n){e.recordNote=null},_nextNote(e,t,n,o){const i=e.time,r=-1===i?[...Array(8).keys()].map(e=>null):e.times[i],s=(i+1)%e.times.length,a=e.times[s];for(var c=0;c<8;c++)r[c]!==a[c]&&(null===a[c]?o("sequencer:releaseNote",{voice:c,note:r[c]}):o("sequencer:attackNote",{voice:c,note:a[c]}));return e.time=s,e},nextNote(e,t){t._nextNote(),t._setRecordedNote()},startPlaying(e,t,n){if(!e.interval)return e.interval=setInterval(t.nextNote,100),e.record=n||!1,e},startRecording(e,t){t.startPlaying(!0)},stopPlaying:(e,t,n,o)=>(e.interval&&clearInterval(e.interval),e.interval=null,e.record=!1,o("sequencer:stopped"),e),setSavedTimes(e,t,n){if(n)return e.times=n,e},setTime:(e,t,n)=>(e.time=n,e)},init(e,t){window.addEventListener("mouseup",e=>t.stopSelection()),window.addEventListener("keydown",e=>{32===e.keyCode&&t.note(null)})},events:{"input:attackNote":(e,t,n)=>("editing"===e.mode&&t.setNoteOnSelection(n),n),"input:releaseNote":[(e,t,n)=>t.recordReleaseNote(n)],"persist:getNotes":(e,t)=>e.times,"persist:setNotes":(e,t,n)=>t.setSavedTimes(n)},views:{grid:(e,t)=>r("table",{className:"sequencer"},["\n                ",e.times.map((n,s)=>r("tr",{},["\n                    ",r("td",{onclick:e=>t.setTime(s),className:"time"},[s]),"\n                    ",n.map((n,a)=>r("td",{onmousedown:e=>{e.preventDefault(!0),t.startSelection([s,a])},onmouseover:e=>{e.preventDefault(!0),t.setSelection(s)},className:(i(e,a,s)?"selected":"")+(e.time===s?" playing":"")},["\n                        ",o(n),"\n                    "])),"\n                "])),"\n            "]),controls:(e,t)=>r("span",{},["\n                ",r("button",{onmousedown:t.startRecording,className:e.record?"active":""},["Rec"]),"\n                ",r("button",{onmousedown:t.startPlaying,className:e.interval?"active":""},["Play"]),"\n                ",r("button",{onmousedown:t.stopPlaying},["Stop"]),"\n                ",r("button",{onmousedown:e=>t.setNote(null)},["X"]),"\n            "])}}},{hyperapp:3}],7:[function(e,t,n){function o(e,t){return Math.exp((12*t+e-s)*Math.log(2)/12)*r}function i(e){return e=e||{},Object.assign({},a,e)}const r=440,s=69,a={octave:4,oscillatorType:"triangle",ampLevel:.3,sustainLevel:.6,attackTime:.02,decayTime:.04,releaseTime:.4,filterType:"lowpass",filterCutoff:7600,filterQ:10};class c{constructor(e,t){t=i(t),this._ctx=e,this._osc=this._ctx.createOscillator(),this._osc.type=t.oscillatorType,this._flt=this._ctx.createBiquadFilter(),this._flt.type=t.filterType,this._flt.frequency.value=t.filterCutoff,this._flt.Q.value=t.filterQ,this._env=this._ctx.createGain(),this._env.gain.value=0,this._amp=this._ctx.createGain(),this._amp.gain.value=t.ampLevel,this._osc.connect(this._flt),this._flt.connect(this._env),this._env.connect(this._amp),this._amp.connect(this._ctx.destination),this._osc.start(),this.octave=t.octave,this.attackTime=t.attackTime,this.decayTime=t.decayTime,this.releaseTime=t.releaseTime,this.sustainLevel=t.sustainLevel,this._playing=!1}get oscillatorType(){return this._osc.type}set oscillatorType(e){this._osc.type=e}get ampLevel(){return this._amp.gain.value}set ampLevel(e){this._amp.gain.value=e}get filterType(){return this._flt.type}set filterType(e){this._flt.type=e}get filterCutoff(){return this._flt.frequency.value}set filterCutoff(e){this._flt.frequency.value=e}get filterQ(){return this._flt.Q.value}set filterQ(e){this._flt.Q.value=e}attack(e){if(this._playing===e)return;this._playing=e;const t=o(e,this.octave);var n=this._ctx.currentTime;this._osc.frequency.cancelScheduledValues(n),this._env.gain.cancelScheduledValues(n),n+=.01,this._osc.frequency.linearRampToValueAtTime(t,n),this._env.gain.linearRampToValueAtTime(0,n),n+=+this.attackTime,this._env.gain.linearRampToValueAtTime(1,n),n+=+this.decayTime,this._env.gain.linearRampToValueAtTime(+this.sustainLevel,n)}release(e){if(this._playing===e){this._playing=null;var t=this._ctx.currentTime+.01;this._env.gain.cancelScheduledValues(t),t+=+this.releaseTime,this._env.gain.linearRampToValueAtTime(0,t)}}stop(){null!==this._playing&&this.release(this._playing)}}t.exports={Synth:c,OSCILLATOR_TYPES:["sawtooth","square","triangle","sine"],FILTER_TYPES:["bandpass","lowpass","highpass"]}},{}],8:[function(e,t,n){const{h:o}=e("hyperapp"),{Synth:i,OSCILLATOR_TYPES:r,FILTER_TYPES:s}=e("./synth"),a=new(window.AudioContext||window.webkitAudioContext),c=({value:e,set:t,min:n,max:i,step:r})=>o("input",{type:"range",min:n||0,max:i,step:r||"any",value:e,oninput:e=>t(e.currentTarget.value)}),l=({options:e,value:t,set:n})=>o("span",{},["\n    ",e.map(e=>o("button",{onclick:t=>n(e),className:t===e?"active":""},["\n            ",e,"\n        "])),"\n"]),u=["oscillatorType","octave","filterType","filterCutoff","filterQ","attackTime","decayTime","releaseTime","sustainLevel","ampLevel"];t.exports={state:{selectedVoice:0,voices:[...Array(8).keys()].map(e=>new i(a))},actions:{selectVoice:(e,t,n)=>({selectedVoice:n}),stopAll:(e,t)=>{e.voices.forEach(e=>e.stop())},setProp:(e,t,[n,o])=>(e.voices[e.selectedVoice][n]=o,e),attackNote:(e,t,[n,o])=>{e.voices[n].attack(o)},releaseNote:(e,t,[n,o])=>{e.voices[n].release(o)}},events:{"persist:getVoices":e=>e.voices.map(e=>{const t={};return u.forEach(n=>{t[n]=e[n]}),t}),"persist:setVoices":(e,t,n)=>{n.forEach((t,n)=>{u.forEach(o=>{e.voices[n][o]=t[o]})})},"sequencer:stopped":(e,t)=>{t.stopAll()},"sequencer:selectVoice":(e,t,n)=>{t.selectVoice(n)},"sequencer:attackNote":(e,t,{voice:n,note:o})=>{t.attackNote([n,o])},"sequencer:releaseNote":(e,t,{voice:n,note:o})=>{t.releaseNote([n,o])},"input:attackNote":(e,t,n)=>{t.attackNote([e.selectedVoice,n])},"input:releaseNote":(e,t,n)=>{t.releaseNote([e.selectedVoice,n])}},views:{voices:(e,t)=>o("voice-selector",{},["\n                ",e.voices.map((n,i)=>o("button",{onmousedown:e=>t.selectVoice(i),className:e.selectedVoice===i?"active":""},["\n                    Voice ",i+1,"\n                "])),"\n            "]),panel:(e,t)=>{const n=n=>c(Object.assign({set:e=>t.setProp([n.name,e]),value:e.voices[e.selectedVoice][n.name]},n)),i=n=>l(Object.assign({set:e=>t.setProp([n.name,e]),value:e.voices[e.selectedVoice][n.name]},n));return o("synth-panel",{},["\n                ",o("div",{className:"col-1"},["\n                    ",o("p",{},["\n                        ",o("label",{},["Oscillator:"]),"\n                        ",i({name:"oscillatorType",options:r}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Octave:"]),"\n                        ",n({name:"octave",min:1,max:6,step:1}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Filter:"]),"\n                        ",i({name:"filterType",options:s}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Cutoff"]),"\n                        ",n({name:"filterCutoff",min:60,max:7600}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Resonance"]),"\n                        ",n({name:"filterQ",max:20}),"\n                    "]),"\n                "]),"\n                ",o("div",{className:"col-2"},["\n                    ",o("p",{},["\n                        ",o("label",{},["Attack Time:"]),"\n                        ",n({name:"attackTime",max:.2}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Decay Time:"]),"\n                        ",n({name:"decayTime",max:.2}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Release Time:"]),"\n                        ",n({name:"releaseTime",max:1}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Sustain Level:"]),"\n                        ",n({name:"sustainLevel",max:1}),"\n                    "]),"\n                    ",o("p",{},["\n                        ",o("label",{},["Amp Level:"]),"\n                        ",n({name:"ampLevel",max:1}),"\n                    "]),"\n                "]),"\n            "])}}}},{"./synth":7,hyperapp:3}]},{},[4]);
